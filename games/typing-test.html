<!doctype html>
<html lang="ko" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>타자 연습 게임</title>
  <link rel="stylesheet" href="../style.css">
  <style>
    .quote-display {
      font-size: 1.5rem;
      margin-bottom: 20px;
      padding: 20px;
      border-radius: 12px;
      background: var(--btn-secondary-bg);
      line-height: 1.6;
    }
    .quote-input {
      width: 100%;
      height: 100px;
      font-size: 1.2rem;
      padding: 10px;
      border-radius: 12px;
      border: 1px solid var(--input-border);
      background: var(--input-bg);
      color: var(--input-text-color);
      resize: none;
    }
    .game-stats { display: flex; justify-content: space-around; font-size: 1.2rem; font-weight: bold; }
    .correct { color: #28a745; }
    .incorrect { color: #dc3545; text-decoration: underline; }
    .difficulty-setting { margin-bottom: 20px; display: flex; gap: 10px; align-items: center; justify-content: center; }
  </style>
</head>
<body>
  <div class="wrap">
    <a href="/" class="home-link">← 홈으로 돌아가기</a>
    <div class="row" style="margin-bottom:14px; align-items: center;">
      <h1 style="margin:0;">타자 연습</h1>
      <button id="themeToggle" class="btn2" style="margin-left: auto;">테마 변경</button>
    </div>

    <div class="card">
       <div class="difficulty-setting">
        <label>난이도:</label>
        <button class="btn2" data-difficulty="easy">쉬움</button>
        <button class="btn2" data-difficulty="normal">보통</button>
        <button class="btn2" data-difficulty="hard">어려움</button>
      </div>
      <div class="game-stats">
        <div>시간: <span id="timer">60</span></div>
        <div>타수: <span id="wpm">0</span></div>
        <div>정확도: <span id="accuracy">100</span>%</div>
      </div>
      <div id="quoteDisplay" class="quote-display"></div>
      <textarea id="quoteInput" class="quote-input" autofocus></textarea>
       <button id="resetButton" class="btn2" style="margin-top: 20px;">재시작</button>
    </div>
  </div>

  <script>
    // Theme switcher
    const themeToggle = document.getElementById('themeToggle');
    const htmlEl = document.documentElement;
    const applyTheme = (theme) => { htmlEl.dataset.theme = theme; localStorage.setItem('theme', theme); };
    themeToggle.addEventListener('click', () => { const currentTheme = htmlEl.dataset.theme === 'dark' ? 'light' : 'dark'; applyTheme(currentTheme); });
    const savedTheme = localStorage.getItem('theme');
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    if (savedTheme) { applyTheme(savedTheme); } else { applyTheme(prefersDark ? 'dark' : 'light'); }

    // Game Logic
    const QUOTES = {
      easy: [
        "하늘이 푸르다.",
        "강아지가 짖는다.",
        "고양이는 귀엽다.",
        "나는 학교에 간다.",
        "바람이 시원하게 분다."
      ],
      normal: [
        "성공의 비결은 끊임없는 노력에 있다.",
        "실패는 성공의 어머니이다.",
        "오늘 할 일을 내일로 미루지 마라.",
        "세상에 공짜는 없다, 모든 것은 노력의 대가이다.",
        "시간은 금이다, 한번 가면 다시 오지 않는다."
      ],
      hard: [
        "개인의 창의성과 팀의 협업은 상호 보완적인 관계를 유지하며, 조직의 혁신을 이끄는 핵심 동력으로 작용한다.",
        "복잡한 현대 사회에서 발생하는 다양한 문제들을 해결하기 위해서는 다각적인 관점과 깊이 있는 통찰력이 요구된다.",
        "지속 가능한 발전을 위해서는 환경 보호와 경제 성장이 조화롭게 공존하는 새로운 패러다임의 전환이 시급하다."
      ]
    };
    
    const quoteDisplayElement = document.getElementById('quoteDisplay');
    const quoteInputElement = document.getElementById('quoteInput');
    const timerElement = document.getElementById('timer');
    const wpmElement = document.getElementById('wpm');
    const accuracyElement = document.getElementById('accuracy');
    const resetButton = document.getElementById('resetButton');
    const difficultyButtons = document.querySelectorAll('.difficulty-setting button');

    let timer;
    let time = 60;
    let interval;
    let difficulty = 'normal';
    let typedChars = 0;
    let correctChars = 0;

    function setDifficulty(newDifficulty) {
      difficulty = newDifficulty;
       document.querySelectorAll('.difficulty-setting button.active').forEach(b => b.classList.remove('active'));
      document.querySelector(`[data-difficulty="${difficulty}"]`).classList.add('active');
      renderNewQuote();
    }

    function getRandomQuote() {
      const quotesArray = QUOTES[difficulty];
      const randomIndex = Math.floor(Math.random() * quotesArray.length);
      return quotesArray[randomIndex];
    }

    async function renderNewQuote() {
      const quote = getRandomQuote();
      quoteDisplayElement.innerHTML = '';
      quote.split('').forEach(character => {
        const characterSpan = document.createElement('span');
        characterSpan.innerText = character;
        quoteDisplayElement.appendChild(characterSpan);
      });
      quoteInputElement.value = null;
      resetTimer();
    }
    
    quoteInputElement.addEventListener('input', () => {
      if (!interval) startTimer();
      
      const arrayQuote = quoteDisplayElement.querySelectorAll('span');
      const arrayValue = quoteInputElement.value.split('');
      
      typedChars = arrayValue.length;
      correctChars = 0;

      arrayQuote.forEach((characterSpan, index) => {
        const character = arrayValue[index];
        if (character == null) {
          characterSpan.classList.remove('correct');
          characterSpan.classList.remove('incorrect');
        } else if (character === characterSpan.innerText) {
          characterSpan.classList.add('correct');
          characterSpan.classList.remove('incorrect');
          correctChars++;
        } else {
          characterSpan.classList.remove('correct');
          characterSpan.classList.add('incorrect');
        }
      });
      
      // Update accuracy
      const accuracy = typedChars > 0 ? Math.round((correctChars / typedChars) * 100) : 100;
      accuracyElement.innerText = accuracy;

      if (arrayValue.length === arrayQuote.length) {
        // WPM calculation
        const elapsedTime = 60 - time;
        const wpm = Math.round((correctChars / 5) / (elapsedTime / 60));
        wpmElement.innerText = wpm;
        clearInterval(interval);
        interval = null;
      }
    });

    function startTimer() {
      time = 60;
      timerElement.innerText = time;
      interval = setInterval(() => {
        time--;
        timerElement.innerText = time;
        if (time === 0) {
          clearInterval(interval);
          interval = null;
          quoteInputElement.disabled = true;
          // WPM calculation at the end
          const elapsedTime = 60;
          const wpm = Math.round((correctChars / 5) / (elapsedTime / 60));
          wpmElement.innerText = wpm;
        }
      }, 1000);
    }
    
    function resetTimer() {
        clearInterval(interval);
        interval = null;
        time = 60;
        timerElement.innerText = time;
        wpmElement.innerText = 0;
        accuracyElement.innerText = 100;
        typedChars = 0;
        correctChars = 0;
        quoteInputElement.disabled = false;
        quoteInputElement.value = '';
        quoteInputElement.focus();
    }
    
    resetButton.addEventListener('click', renderNewQuote);
     difficultyButtons.forEach(button => {
        button.addEventListener('click', () => setDifficulty(button.dataset.difficulty))
    });

    setDifficulty('normal');
  </script>
</body>
</html>
